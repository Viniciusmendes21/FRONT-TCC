<div class="correcao-container">
  <h2>Correção de Redação por IA (Gemini)</h2>

  <form (ngSubmit)="enviar()" class="correcao-form" autocomplete="off" enctype="multipart/form-data">
    <div class="form-group">
      <label for="tema">Tema</label>
      <input
        id="tema"
        type="text"
        [(ngModel)]="tema"
        name="tema"
        required
        placeholder="Digite o tema da redação"
      />
    </div>
    <div class="form-group">
      <label for="arquivo">Arquivo PDF da Redação</label>
      <input
        id="arquivo"
        type="file"
        accept="application/pdf"
        (change)="onFileSelected($event)"
        name="arquivo"
      />
      <small>Opcional: você pode enviar um PDF ou digitar o texto abaixo.</small>
    </div>
    <div class="form-group">
      <label for="texto">Texto da Redação (opcional)</label>
      <textarea
        id="texto"
        rows="8"
        [(ngModel)]="texto"
        name="texto"
        placeholder="Digite seu texto aqui (opcional)"
      ></textarea>
    </div>
    <button
      type="submit"
      [disabled]="!tema || carregando"
      class="btn-enviar"
    >
      {{ carregando ? 'Corrigindo...' : 'Enviar para Correção' }}
    </button>
  </form>

  <div *ngIf="erro" class="erro-msg">
    <pre>{{ erro }}</pre>
  </div>

  <div *ngIf="resultado?.success" class="resultado-card">
    <h3>Resultado da Correção</h3>
    <div class="criterio">
      <span><strong>Compreensão do Tema e Proposta:</strong></span>
      <span class="nota">{{ resultado.compreensao_tema_proposta.nota }}/200</span>
      <div class="comentario">{{ resultado.compreensao_tema_proposta.comentarios }}</div>
    </div>
    <div class="criterio">
      <span><strong>Coesão e Coerência:</strong></span>
      <span class="nota">{{ resultado.coesao_coerencia.nota }}/200</span>
      <div class="comentario">{{ resultado.coesao_coerencia.comentarios }}</div>
    </div>
    <div class="criterio">
      <span><strong>Argumentação:</strong></span>
      <span class="nota">{{ resultado.argumentacao.nota }}/200</span>
      <div class="comentario">{{ resultado.argumentacao.comentarios }}</div>
    </div>
    <div class="criterio">
      <span><strong>Domínio da Escrita Formal:</strong></span>
      <span class="nota">{{ resultado.dominio_escrita_formal.nota }}/200</span>
      <div class="comentario">{{ resultado.dominio_escrita_formal.comentarios }}</div>
    </div>
    <div class="criterio">
      <span><strong>Proposta de Intervenção:</strong></span>
      <span class="nota">{{ resultado.proposta_intervencao.nota }}/200</span>
      <div class="comentario">{{ resultado.proposta_intervencao.comentarios }}</div>
    </div>
    <div class="media-geral">
      <strong>Nota Final:</strong>
      <span class="nota-final">{{ resultado.nota_final }}/1000</span>
    </div>
  </div>

  <div *ngIf="resultado && !resultado.success" class="erro-msg">
    <strong>Erro:</strong>
    <pre>{{ resultado.message || resultado.error }}</pre>
  </div>
</div>